<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CekKuotaXL.my.id - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .brand-gradient { background: linear-gradient(135deg, #0052d4, #4364f7, #6fb1fc); }
        #result { white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', Courier, monospace; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-md mt-6 mb-8 text-center">
        <h1 class="text-3xl font-bold text-blue-700 italic">CekKuota<span class="text-blue-400">XL.my.id</span></h1>
        <p class="text-gray-500 text-xs mt-1 uppercase tracking-widest">Sidompul API Gateway v4.0</p>
    </div>

    <div class="w-full max-w-md glass rounded-3xl shadow-xl overflow-hidden border border-white">
        <div class="brand-gradient p-6 text-white text-center">
            <h2 class="text-xl font-semibold">Cek Sisa Kuota</h2>
            <div id="limitBadge" class="inline-block bg-white/20 px-3 py-1 rounded-full text-[10px] mt-2 font-bold uppercase tracking-tighter">
                Sisa Jatah Cek: <span id="limitText">3</span>
            </div>
        </div>

        <div class="p-6">
            <div class="mb-5">
                <label class="block text-[10px] font-black text-gray-400 mb-2 ml-1 uppercase">Nomor XL / AXIS</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-blue-500">
                        <i class="fas fa-mobile-alt"></i>
                    </span>
                    <input type="text" id="nomor" placeholder="Contoh: 0819xxxxxxxx" 
                        class="w-full pl-12 pr-4 py-4 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-lg font-bold text-gray-700">
                </div>
            </div>

            <button onclick="prosesCek()" id="btnCek" class="w-full brand-gradient text-white font-black py-4 rounded-2xl shadow-lg hover:opacity-90 transition transform active:scale-95 flex items-center justify-center">
                <i class="fas fa-search-dollar mr-2 text-lg"></i> CEK KUOTA SEKARANG
            </button>

            <div id="loading" class="hidden mt-8 text-center">
                <div class="inline-block animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-blue-600"></div>
                <p class="text-sm text-gray-500 mt-3 font-medium italic">Sedang Menghubungi Server...</p>
            </div>

            <div id="resultBox" class="mt-8 hidden animate-fade-in">
                <div class="bg-blue-50 p-5 rounded-3xl border border-blue-100 shadow-inner">
                    <p class="text-[10px] text-blue-600 font-black uppercase mb-3 border-b border-blue-200 pb-1">Hasil Pencarian</p>
                    <div id="result" class="text-[12px] text-gray-800 leading-relaxed font-semibold"></div>
                </div>
                <button onclick="location.reload()" class="w-full mt-4 text-xs text-gray-400 font-bold uppercase hover:text-blue-500 transition">
                    <i class="fas fa-redo-alt mr-1"></i> Bersihkan Hasil
                </button>
            </div>
        </div>
    </div>

    <div class="mt-10 text-center text-gray-400 text-[10px] space-y-2 mb-10">
        <p class="font-bold">&copy; 2026 CEKKUOTAXL.MY.ID</p>
        <div class="flex justify-center gap-4">
            <span class="bg-white px-2 py-1 rounded border border-gray-200">SSL ENCRYPTED</span>
            <span class="bg-white px-2 py-1 rounded border border-gray-200">OFFICIAL API</span>
        </div>
    </div>

    <script>
    // --- JURUS BAYANGAN (OBFUSCATION) ---
    const _a1 = "c2lkb21wdWxh"; const _a2 = "cGk6YXBpZ3dr"; const _a3 = "bXNw";
    const _k1 = "60ef29aa-"; const _k2 = "a648-4668-90ae-"; const _k3 = "20951ef90c55";
    const MAX_CEK = 3;

    function getCekCount() {
        const today = new Date().toDateString();
        const data = JSON.parse(localStorage.getItem('cek_limit_xl') || '{}');
        return data.date !== today ? 0 : data.count || 0;
    }

    function renderLimit() {
        const sisa = MAX_CEK - getCekCount();
        const limitText = document.getElementById('limitText');
        const btn = document.getElementById('btnCek');
        
        limitText.innerText = sisa < 0 ? 0 : sisa;
        
        if(sisa <= 0) {
            btn.disabled = true;
            btn.className = "w-full bg-red-500 text-white font-black py-4 rounded-2xl shadow-lg opacity-80 cursor-not-allowed flex items-center justify-center";
            btn.innerHTML = '<i class="fas fa-clock mr-2"></i> JATAH HARIAN HABIS';
        } else {
            btn.disabled = false;
            btn.className = "w-full brand-gradient text-white font-black py-4 rounded-2xl shadow-lg hover:opacity-90 transition transform active:scale-95 flex items-center justify-center";
            btn.innerHTML = '<i class="fas fa-search-dollar mr-2 text-lg"></i> CEK KUOTA SEKARANG';
        }
    }

    // --- PINTU BELAKANG ADMIN (AUTO RESET) ---
    document.getElementById('nomor').addEventListener('input', function(e) {
        if (e.target.value === "3703") { // Ganti kode admin kamu di sini
            localStorage.removeItem('cek_limit_xl');
            renderLimit();
            alert("üî• OWNER DETECTED: Limit harian berhasil di-reset!");
            e.target.value = "";
        }
    });

    renderLimit();

    async function prosesCek() {
        const nomor = document.getElementById('nomor').value;
        const resultBox = document.getElementById('resultBox');
        const resultDiv = document.getElementById('result');
        const loading = document.getElementById('loading');
        const btn = document.getElementById('btnCek');

        if(!nomor || nomor.length < 9) return alert("Masukkan nomor XL/Axis yang valid!");

        let msisdn = nomor.startsWith('08') ? '62' + nomor.slice(1) : nomor;

        // UI State: Loading
        loading.classList.remove('hidden');
        resultBox.classList.add('hidden');
        btn.disabled = true;

        try {
            // Reconstruct Keys
            const auth = btoa(atob(_a1 + _a2 + _a3));
            const xkey = _k1 + _k2 + _k3;

            const response = await fetch(`https://apigw.kmsp-store.com/sidompul/v4/cek_kuota?msisdn=${msisdn}&isJSON=true`, {
                headers: {
                    "Authorization": "Basic " + auth,
                    "X-API-Key": xkey,
                    "X-App-Version": "4.0.0"
                }
            });

            const res = await response.json();

            if (res.status === true) {
                // Update Limit (Hanya jika berhasil)
                const count = getCekCount() + 1;
                localStorage.setItem('cek_limit_xl', JSON.stringify({ date: new Date().toDateString(), count: count }));
                renderLimit();

                const sp = res.data.data_sp;
                let detail = res.data.hasil.replace(/<br>/g, '\n').replace(/<\/?[^>]+(>|$)/g, "");
                
                resultDiv.innerText = `[ INFO OPERATOR ]\nPrefix: ${sp.prefix.value}\nExp: ${sp.active_period.value}\n\n[ DETAIL KUOTA ]\n${detail}`;
                resultBox.classList.remove('hidden');
            } else {
                resultDiv.innerText = "‚ùå ERROR: " + (res.data.keteranganError || "Nomor tidak ditemukan atau API sibuk.");
                resultBox.classList.remove('hidden');
            }
        } catch (err) {
            alert("Gagal terhubung ke API Sidompul. Pastikan koneksi internet aktif!");
        } finally {
            loading.classList.add('hidden');
            if (getCekCount() < MAX_CEK) btn.disabled = false;
        }
    }
    </script>
</body>
</html>
